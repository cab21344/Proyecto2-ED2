// Electrónica Digital 2 - Proyecto 2
// María Daniela Cabrera Porras, 21344

// Librerías ******************************************************
#include <Arduino.h>
#include <DHT.h> //librería sensor de temp y humedad
//*****************************************************************

// Definiciones ***************************************************
#define DHTTYPE DHT11
//*****************************************************************

// DHTPINes display **************************************************
#define DHTPIN 4

DHT dht(DHTPIN, DHTTYPE);
//*****************************************************************

// Variables ******************************************************
String bufferTiva;
//*****************************************************************

void setup()
{
  // inicia el sensor
  dht.begin();

  // start the serial connection
  Serial.begin(115200);
  Serial2.begin(115200);
  // wait for serial monitor to open
  while (!Serial)
    ;
  Serial.print("Conectando...");

  // Configurar entradas y salidas ********************************
  pinMode(DHTPIN, INPUT);
  //***************************************************************
}

void loop()
{

  float temp = dht.readTemperature();
  float hum = dht.readHumidity();

  if (!isnan(temp) && !isnan(hum))
  {                                          // verifica que sean números
    Serial.print("Temperatura: "); // inmprime info sensor
    Serial.println(temp);
    Serial.print("Humedad: ");
    Serial.println(hum);
    Serial.println("------------------------------");
    delay(3000);
  }

  if (Serial2.available())
  {
    String inData = Serial2.readStringUntil('\n');

    if (inData == "measure")
    {
      if (!isnan(temp) && !isnan(hum))
      {
        Serial2.print("Temperatura y humedad: ");
        Serial2.print(temp);
        Serial2.print(";");
        Serial2.println(hum);
        Serial.println("Se envió satisfactoriamente la información!");
      }
      else
      {
        Serial2.println("Error en la lectura del sensor. Intente nuevamente.");
      }
    }
  }
}
