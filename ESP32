// Electrónica Digital 2 - Proyecto 2
// María Daniela Cabrera Porras, 21344

// Librerías ******************************************************
#include <Arduino.h>
//*****************************************************************

// Pines display **************************************************
#define ecgPin 35
//*****************************************************************

// Variables ******************************************************
int latidos = 0;
String bufferTiva;
void medirSens(void);
//*****************************************************************

void setup()
{
  // start the serial connection
  Serial.begin(115200);
  Serial2.begin(115200);
  // wait for serial monitor to open
  while (!Serial);
  Serial.print("Conectando...");
  
  // Configurar entradas y salidas ********************************
  pinMode(ecgPin, INPUT);
  //*************************************************************** 
}


void loop()
{  
  Serial.print("Ritmo cardiaco: ");
  Serial.println(latidos); //imprime la lectura del sensor cardiaco
  delay(1000);


 if(Serial2.available()){
  String inData = Serial2.readStringUntil('\n');

    if(inData == "measure"){
      Serial.println("Medición");
      medirSens();
      Serial2.println(latidos);

      Serial.print("El ritmo cardiaco es de: ");
      Serial.println(latidos);
    }
  }
}

void medirSens(void){
  latidos = analogRead(ecgPin);
}
