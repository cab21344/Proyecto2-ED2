// Electrónica Digital 2 - Proyecto 2
// María Daniela Cabrera Porras, 21344

// Librerías ******************************************************
#include <Arduino.h>
#include <SPI.h>
//*****************************************************************

// Pines display **************************************************
#define ecgPin 35
#define tivaPin 5
//*****************************************************************

// Variables ******************************************************
int latidos = 0;
//*****************************************************************

void setup()
{
  // start the serial connection
  Serial.begin(115200);
  // wait for serial monitor to open
  while (!Serial);
  Serial.print("Connecting...");
  
  //Conf comunicación con Tiva**************************************
  SPI.begin(tivaPin); //inicia comunicación SPI con la tiva
  SPI.setBitOrder(MSBFIRST); //conf ordfen de los bits
  SPI.setDataMode(SPI_MODE0); //conf el modo de los datos SPI
  SPI.setClockDivider(SPI_CLOCK_DIV16); //conf velocidad de comunicación
  //***************************************************************

  // Configurar entradas y salidas ********************************
  pinMode(ecgPin, INPUT);
  pinMode(tivaPin, OUTPUT);
  //***************************************************************
  
  //Lectura del sensor y envío del valor a tiva *******************
    int latidos = digitalRead(ecgPin);
    SPI.transfer(&latidos, sizeof(latidos)); 
  //***************************************************************

}

void loop()
{
  Serial.print("Ritmo cardiaco: ");
  Serial.println(latidos); //imprime la lectura del sensor cardiaco
  delay(1000);
}

int lecturaCorazon(){ //lectura del sensor ritmo cardiaco
  digitalWrite(tivaPin, LOW); //selecciona el pin de la tiva para com
  SPI.transfer(1); //envía comando para solicitar lectura del sensor
  delay(10);
  int latidos = SPI.transfer(0);//recibe respuesta del dispositivo esclavo
  digitalWrite(tivaPin, HIGH); //deja de seleccionar la tiva

  return latidos;//devuelve calor del sensor
}
